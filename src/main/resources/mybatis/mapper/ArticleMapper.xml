<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="win.hupubao.mapper.ArticleMapper" >

	<sql id="conditions">
		<where>
			<if test="@win.hupubao.common.utils.StringUtils@isNotBlank(title)" >
				and title like '%' || #{title, jdbcType=VARCHAR} || '%'
			</if>

            <if test="@win.hupubao.common.utils.StringUtils@isNotBlank(categoryId)">
                and category_id = #{categoryId, jdbcType=VARCHAR}
            </if>

            <if test="@win.hupubao.common.utils.StringUtils@isNotBlank(tagId)">
                and at.tag_id = #{tagId, jdbcType=VARCHAR}
            </if>
            <if test="@win.hupubao.common.utils.StringUtils@isNotBlank(status)">
                and `status` = #{status, jdbcType=INTEGER}
            </if>
		</where>
	</sql>


	<select id="selectList"
			parameterType="win.hupubao.beans.biz.ArticleBean"
			resultType="win.hupubao.beans.biz.ArticleBean">
		select
			a.*,
			c.name as category,
			GROUP_CONCAT(t.name, ',') as tags

		from article a
			left join category c on a.category_id = c.id
			left join article_tag at on a.id = at.article_id
			left join tag t on at.tag_id = t.id
		<include refid="conditions"/>
		group by a.id
	</select>
</mapper>